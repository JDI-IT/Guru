<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Announcements</title>

<style>
  :root{
    --page-bg:#0b0c0f;      /* dark page */
    --card-bg:#fff;         /* white cards */
    --text:#171717;
    --muted:#5f6368;
    --ring:#e5e7eb;
    --accent:#111827;
    --brand:#111827;        /* button color */
    --radius:16px;
    --shadow:0 12px 28px rgba(0,0,0,.20);

    /* viewport sizing for the ‚Äúcarousel-like‚Äù scroller */
    --rows: 2;              /* number of visible cards */
    --card-h: 120px;        /* card height (content area) */
    --gap: 14px;            /* gap between cards */
    --pad: 8px;             /* top/bottom padding in scroller */
    --scroller-h: calc(var(--rows) * var(--card-h) + (var(--rows) - 1)*var(--gap) + var(--pad)*2);
  }

  *{ box-sizing:border-box }
  html,body{
    margin:0; background:var(--page-bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  .wrap{ max-width:100%; padding:8px; }
  .inner{ max-width:920px; margin:0 auto; }

  /* Search bar only (no title) */
  .bar{
    display:flex; justify-content:flex-end; align-items:center; gap:8px;
    margin:6px 0 8px;
  }
  .search{
    background:#fff; border:1px solid var(--ring); border-radius:10px;
    padding:10px 12px; font-size:14px; min-width:240px;
  }

  /* Scroller showing exactly N cards with snap */
  .scroller{
    height: var(--scroller-h);
    overflow-y: auto;
    padding: var(--pad) 0;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
    display: grid;
    gap: var(--gap);
  }
  /* keep a subtle thin scrollbar */
  .scroller::-webkit-scrollbar{ width:8px }
  .scroller::-webkit-scrollbar-thumb{ background:#2a2b2f; border-radius:999px }
  .scroller{ scrollbar-width:thin; scrollbar-color:#2a2b2f transparent }

  .card{
    scroll-snap-align: start;
    background:var(--card-bg); border:1px solid var(--ring);
    border-radius:var(--radius); box-shadow:var(--shadow);
    padding:14px 16px;
    min-height: var(--card-h);
    display:grid; grid-template-columns:1fr auto; gap:8px 16px;
    align-items:center;
  }
  .meta{
    font-size:12px; color:var(--muted); display:flex; gap:8px; align-items:center;
  }
  .tag{
    font-size:11px; padding:4px 8px; border:1px solid var(--ring);
    border-radius:999px; background:#fafafa; color:#333;
  }
  .title{
    font-weight:800; font-size:16px; color:var(--accent); margin:2px 0 4px;
  }
  .summary{
    font-size:14px; color:var(--text); margin:0; line-height:1.55;
  }

  .cta{ justify-self:end; align-self:center; }
  .btn{
    display:inline-flex; align-items:center; gap:8px;
    font-size:13px; font-weight:700; color:#fff;
    background:var(--brand); border-radius:10px;
    padding:10px 12px; text-decoration:none; white-space:nowrap;
  }
  .btn:hover{ filter:brightness(1.05) }
  .btn:active{ transform:translateY(1px) }

  .empty{ color:#fff; opacity:.85; text-align:center; padding:24px 0 }

  @media (max-width:680px){
    :root{ --card-h: 140px; }     /* a bit taller cards on mobile */
    .card{ grid-template-columns:1fr; }
    .cta{ justify-self:stretch }
    .btn{ width:100%; justify-content:center }
  }
</style>
</head>
<body>
  <div class="wrap"><div class="inner">

    <div class="bar">
      <input id="q" class="search" type="search" placeholder="Search announcements..." />
    </div>

    <div id="empty" class="empty" style="display:none">No announcements yet.</div>
    <div id="scroller" class="scroller"></div>

  </div></div>

<script>
  const cacheBuster = 'ts=' + Date.now();
  const scroller = document.getElementById('scroller');
  const emptyEl = document.getElementById('empty');
  const q = document.getElementById('q');
  let all = [], filtered = [];

  fetch('announcements.json?' + cacheBuster, { cache: 'no-store' })
    .then(r => { if(!r.ok) throw new Error('announcements.json not found'); return r.json(); })
    .then(items => {
      // Date window: last 1 month (inclusive) up to today (no future)
      const now = stripTime(new Date());
      const oneMonthAgo = stripTime(addMonths(now, -1));

      all = (items || [])
        .filter(x => {
          const d = parseISO(x.date);
          return d && d >= oneMonthAgo && d <= now;   // üëà keep last 1 month only; hide future
        })
        .map(x => ({
          title: String(x.title || '').trim(),
          date: parseISO(x.date),
          dateText: x.date || '',
          summary: String(x.summary || '').trim(),
          url: String(x.url || '#').trim(),
          tag: String(x.tag || '').trim()
        }))
        .sort((a,b) => (b.date?.getTime()||0) - (a.date?.getTime()||0));

      filtered = all.slice();
      render();
    })
    .catch(err => {
      console.error(err);
      emptyEl.style.display = 'block';
      emptyEl.textContent = '‚ö†Ô∏è Could not load announcements.json';
    });

  function render(){
    emptyEl.style.display = filtered.length ? 'none' : 'block';
    scroller.innerHTML = filtered.map(cardHtml).join('');
  }

  function cardHtml(x){
    const tag = x.tag ? `<span class="tag">${esc(x.tag)}</span>` : '';
    const date = x.dateText ? `<span>${esc(x.dateText)}</span>` : '';
    return `
      <article class="card">
        <div>
          <div class="meta">${tag}${date ? ' ¬∑ ' + date : ''}</div>
          <h3 class="title">${esc(x.title)}</h3>
          <p class="summary">${esc(x.summary)}</p>
        </div>
        <div class="cta">
          <a class="btn" href="${x.url}" target="_blank" rel="noopener">View more</a>
        </div>
      </article>
    `;
  }

  // Helpers
  function esc(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;'); }
  function parseISO(v){
    if(!v) return null;
    const d = new Date(v + 'T00:00:00'); // local midnight to avoid TZ drift
    return isNaN(d.getTime()) ? null : stripTime(d);
  }
  function stripTime(d){
    const t = new Date(d);
    t.setHours(0,0,0,0);
    return t;
  }
  function addMonths(d, n){
    const t = new Date(d);
    t.setMonth(t.getMonth() + n);
    return t;
  }

  // search
  q.addEventListener('input', () => {
    const term = q.value.trim().toLowerCase();
    filtered = !term ? all.slice() : all.filter(x =>
      x.title.toLowerCase().includes(term) ||
      x.summary.toLowerCase().includes(term) ||
      x.tag.toLowerCase().includes(term)
    );
    render();
    scroller.scrollTo({ top: 0, behavior: 'instant' });
  });
</script>
</body>
</html>
